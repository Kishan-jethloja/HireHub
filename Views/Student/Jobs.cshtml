@model IEnumerable<PlacementManagementSystem.Models.JobPosting>
@{
	ViewData["Title"] = "Jobs";
}

<div class="d-flex justify-content-between align-items-center mb-3">
	<h2 class="mb-0">Jobs for Your College</h2>
	<a class="btn btn-outline-primary" asp-controller="Student" asp-action="Profile">Edit Profile</a>
</div>

@if (TempData["Error"] != null)
{
	<div class="alert alert-danger">@TempData["Error"]</div>
}

@if (TempData["AppSuccess"] != null)
{
	<div class="alert alert-success">@TempData["AppSuccess"]</div>
}

@if (!Model.Any())
{
	<div class="alert alert-info">No jobs found right now. Check back later.</div>
}
else
{
	<div class="row">
		@foreach (var job in Model)
		{
			<div class="col-md-4 mb-4">
				<div class="card h-100 shadow-sm">
					<div class="card-body d-flex flex-column">
						<div class="d-flex justify-content-between align-items-start mb-2">
							<h5 class="card-title mb-0">@job.Title</h5>
							<span class="badge badge-primary">@job.Type</span>
						</div>
						<p class="text-muted mb-2">
							<i class="fas fa-map-marker-alt mr-1"></i>@(string.IsNullOrWhiteSpace(job.Location) ? "Remote/NA" : job.Location)
							@if (job.MinimumCPI.HasValue)
							{
								<span class="badge badge-info ml-2">Min CPI: @job.MinimumCPI</span>
							}
						</p>
						@if (!string.IsNullOrWhiteSpace(job.Description))
						{
							<p class="card-text text-truncate" title="@job.Description">@job.Description</p>
						}
						<div class="mt-auto d-flex justify-content-between align-items-center">
							<small class="text-muted">Apply by: @(job.ApplyByUtc?.ToString("yyyy-MM-dd") ?? "-")</small>
							@{ var applied = ((System.Collections.Generic.HashSet<int>)ViewBag.AppliedJobIds)?.Contains(job.Id) ?? false; }
							@if (applied)
							{
								<a class="btn btn-secondary btn-sm" asp-action="Apply" asp-route-id="@job.Id">Edit</a>
							}
							else
							{
								<a class="btn btn-primary btn-sm" asp-action="Apply" asp-route-id="@job.Id">Apply</a>
							}
						</div>
					</div>
				</div>
			</div>
		}
	</div>
}


