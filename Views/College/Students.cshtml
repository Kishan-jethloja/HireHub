@model IEnumerable<PlacementManagementSystem.Models.Student>
@{
	ViewData["Title"] = "Students";
}

@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["Success"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Students</h2>
</div>

@if (!Model.Any())
{
	<div class="alert alert-info">No students found.</div>
}
else
{
	<div class="table-responsive">
		<table class="table table-striped table-hover">
			<thead>
				<tr>
					<th>Student ID</th>
					<th>Name</th>
					<th>College</th>
					<th>Department</th>
					<th>Year</th>
					<th>CPI</th>
					<th>Status</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				@foreach (var s in Model)
				{
					<tr>
						<td>@s.StudentId</td>
					<td>@(ViewBag.UserNames != null && ((IDictionary<string, string>)ViewBag.UserNames).ContainsKey(s.UserId) ? ((IDictionary<string, string>)ViewBag.UserNames)[s.UserId] : "-")</td>
						<td>@s.CollegeName</td>
						<td>@s.Department</td>
						<td>@s.Year</td>
						<td>@s.CGPA</td>
						<td>
							@if (s.IsApproved)
							{
								<span class="badge badge-success">Approved</span>
							}
							else if (s.CollegeName == "Unassigned")
							{
								<span class="badge badge-danger">Rejected</span>
							}
							else
							{
								<span class="badge badge-warning">Pending</span>
							}
						</td>
						<td class="text-right">
							@if (s.CollegeName == "Unassigned")
							{
								<span class="text-danger">
									<i class="fas fa-times-circle"></i> Rejected
								</span>
							}
							else if (!s.IsApproved)
							{
								<div class="btn-group" role="group">
									<form asp-action="ApproveStudent" method="post" class="d-inline">
										@Html.AntiForgeryToken()
										<input type="hidden" name="id" value="@s.Id" />
										<button class="btn btn-sm btn-success" type="submit" onclick="return confirm('Are you sure you want to approve this student?')">
											<i class="fas fa-check"></i> Approve
										</button>
									</form>
									<form asp-action="RejectStudent" method="post" class="d-inline ml-1">
										@Html.AntiForgeryToken()
										<input type="hidden" name="id" value="@s.Id" />
										<button class="btn btn-sm btn-danger" type="submit" onclick="return confirm('Are you sure you want to reject this student?')">
											<i class="fas fa-times"></i> Reject
										</button>
									</form>
								</div>
							}
							else
							{
								<span class="text-success">
									<i class="fas fa-check-circle"></i> Approved
								</span>
							}
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
}


